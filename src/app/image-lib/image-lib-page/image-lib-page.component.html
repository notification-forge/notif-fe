<section class="image-lib-page-wrapper">
  <div class="button-wrapper">
    <button nz-button nzType="primary" (click)="openForm()">
      Upload New Image
    </button>
  </div>
  <div class="input-wrapper">
    <nz-input-group nzSearch [nzAddOnAfter]="suffixIconButton">
      <input
        type="text"
        nz-input
        placeholder="Search for image file name"
        [ngModel]="query"
        (ngModelChange)="onSearch($event)"
      />
    </nz-input-group>

    <nz-select
      name="app"
      ngDefaultControl
      [ngModel]="selectedAppCodes"
      (ngModelChange)="onAppFilterSelect($event)"
      nzMode="tags"
      nzPlaceHolder="Please select app"
    >
      <nz-option
        *ngFor="let option of listOfOption"
        [nzLabel]="option.label"
        [nzValue]="option.value"
      ></nz-option>
    </nz-select>
  </div>

  <div class="content">
    <nz-card
      *ngFor="let image of images"
      nzHoverable
      style="width: 220px; margin: 1rem"
      [nzCover]="coverTemplate"
      [nzActions]="[actionDelete]"
    >
      <nz-card-meta
        [nzTitle]="image.fileName"
        [nzDescription]="image.app"
      ></nz-card-meta>
      <ng-template #coverTemplate>
        <img [alt]="image.fileName" [src]="image.url" />
      </ng-template>
      <ng-template #actionDelete>
        <button nz-button nzType="text" nzDanger>
          <i nz-icon nzType="delete"></i>
        </button>
      </ng-template>
    </nz-card>
  </div>
</section>

<ng-template #suffixIconButton>
  <button nz-button nzType="primary" nzSearch>
    <i nz-icon nzType="search"></i>
  </button>
</ng-template>

<nz-modal
  [(nzVisible)]="showUploadImageForm"
  nzTitle="Upload Image"
  (nzOnCancel)="closeForm()"
  [nzFooter]="modalFooter"
>
  <ng-template nzModalContent>
    <form nz-form [formGroup]="uploadImageForm">
      <nz-form-item>
        <nz-form-label nzFor="appCode" nzRequired> App Code</nz-form-label>
        <nz-form-control nzErrorTip="Please select the app code!">
          <nz-select
            formControlName="appCode"
            name="appCode"
            nzPlaceHolder="Please select app"
          >
            <nz-option
              *ngFor="let app of appList"
              [nzLabel]="app.appName"
              [nzValue]="app.appCode"
            ></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzFor="file" nzRequired> Choose File </nz-form-label>
        <input
          #fileInput
          type="file"
          formControlName="file"
          (change)="onChange($event)"
        />
        <!-- <nz-form-control nzErrorTip="Please upload Image!">
          <nz-input-group nzPrefixIcon="user">
            <input
              type="text"
              nz-input
              formControlName="templateName"
              placeholder="Template Name"
              name="templateName"
            />
          </nz-input-group>
        </nz-form-control> -->
      </nz-form-item>
    </form>
  </ng-template>

  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="closeForm()">Cancel</button>
    <button
      nz-button
      [nzType]="'primary'"
      type="submit"
      (click)="onFormSubmit()"
      [disabled]="!uploadImageForm.valid"
      [nzLoading]="formLoading"
    >
      Upload Image
    </button>
  </ng-template>
</nz-modal>
